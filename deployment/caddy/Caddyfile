# Todo List Application
todo.example.com {
    # Serve static assets directly
    handle /css/* {
        root * /opt/javascript-apps/todo-list/dist
        file_server
    }
    
    handle /js/* {
        root * /opt/javascript-apps/todo-list/dist
        file_server
    }
    
    # API routes to backend
    handle /api/* {
        reverse_proxy localhost:3001
    }
    
    # All other routes serve index.html (SPA support)
    handle {
        root * /opt/javascript-apps/todo-list/dist
        try_files {path} /index.html
        file_server
    }
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
    }
    
    # Enable compression
    encode gzip
    
    # Logging
    log {
        output file /var/log/caddy/todo-app.log
    }
}

# Weather Application
weather.example.com {
    # Serve static assets directly
    handle /css/* {
        root * /opt/javascript-apps/weather/dist
        file_server
    }
    
    handle /js/* {
        root * /opt/javascript-apps/weather/dist
        file_server
    }
    
    # API routes to backend
    handle /api/* {
        reverse_proxy localhost:3000
    }
    
    # All other routes serve appropriate HTML files
    handle {
        root * /opt/javascript-apps/weather/dist
        try_files {path} {path}.html {path}/index.html /index.html
        file_server
    }
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
    }
    
    # Enable compression
    encode gzip
    
    # Logging
    log {
        output file /var/log/caddy/weather-app.log
    }
}

# Development configuration (optional)
localhost:3001 {
    reverse_proxy localhost:3001
}

localhost:3000 {
    reverse_proxy localhost:3000
}